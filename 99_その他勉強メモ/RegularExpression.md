# 1
## 正規表現とは
- 伊藤さん的には「パターンを指定して、文字列を効率よく検索・置換するためのミニ言語」
### 電話番号を探す
- 正規表現においては`\d`は特別な意味をもち、半角数字を指す。この文字を文字を***メタ文字***という。
- 電話番号を探す場合、メタ文字を繋げて`\d\d-\d\d\d\d-\d\d\d\d`と記述することで、電話番号を探すことができる。
#### 色々な市外局番に対応する。
- 03-1234-5678や、090-1234-5678を電話番号として検索する場合、半角数字の個数が異なるため`\d\d-\d\d\d\d-\d\d\d\d`では検索できない。
- この場合、数字の個数のパターンを見つけ、指定することで検索できるようになる。

半角数字２〜５個、ハイフン、半角数字が１〜４個、ハイフン、半角数字４個

- 文字の個数を指定する場合、　`{m,n}`や`{n}`というメタ文字で指定することができる。
```
\d{2,5}-\d{1,4}-\d{4}
```
#### いろいろな記号に対応する
- 電話番号に（）が入る場合、上記の`\d{2,5}-\d{1,4}-\d{4}`では対応できない。
- 同様にパターンを見つけて指定することで検索できるようになる。

半角数字が2個～5個、ハイフンまたはカッコ（開き）、半角数字が1個～4個、ハイフンまたはカッコ（閉じ）、半角数字が4個

- AまたはB、という指定は[AB]で指定できる。上記のは「ハイフンまたはカッコ（開き）」は`[-(]`で表すことができる。
```
\d{2,5}[-(]\d{1,4}[-)]\d{4}
```
#### []の中のハイフンは要注意
- []の中のハイフンは、場合によっては特別な意味を持つ。 `[a-c]` と書くと、「aまたはbまたはc」という意味となる。
- つまり、[]の中のハイフンは文字の範囲を表す。

## 検索の精度と正規表現の複雑さについて
- 正規表現で完璧を目指そうとすると、とても複雑になり作成やメンテナンスに大きな負担がかかる。一方で、Web入力フォームで使用する正規表現には、ある程度の精度が求められる。
- 実際は、「そこそこの精度の正規表現で妥協する」ということがある。また、プログラミング言語を使って精度を補完する、というアプローチもできる。

# 2
## カタカナの揺れを許容する
### 様々な区切り文字を許容する
- 記事①で学んだ[AB](AまたはB)という書き方を使うと、[ 　・]と書くことができる（半角スペース、全角スペース、「・」を含む）
### 濁点の有無を許容する
- [ゲケ]と書くことで、濁点の有無を許容することができる。
### 区切り文字の有無を許容する。
- 「区切り文字が1文字、 もしくは区切り無し」は`?`というメタ文字を使う。文字量を指定するので、量指定子の一つ。
- `[ 　・]?`が「全角スペース、半角スペース、・、もしくは区切り文字無し」を指定する。
### 区切り文字を簡易的に表示する
- `[ 　・]`の部分において、文字種を全て明示しなくても、`.`と書くことで任意の文字」という指定ができる。

## HTMLタグをCSVに変換する
正規表現は、検索だけでなく置換に使うこともできる。

### valueを抜き出す正規表現を考える
```html
<select name="game_console">
<option value="wii_u">Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select>
```
以下の通り進めていく
1. 行全体にマッチする正規表現を作る。
2. value と表示テキストをキャプチャする。
3. キャプチャを利用して新しい文字列を組み立てる。

### 行全体にマッチする正規表現を作る。
- 今回の例においては、抜き出すテキストはHTMLタグに囲まれているため、`>`と`<`に囲まれている、と考えることができる。このタグに囲まれている一文字以上の文字列を示すには、`>.+<`と書くことで示すことができる。
- 文字列が変動する箇所には正規表現を当てはめ、それ以外では（ただの）文字列を記述する。
  - `[a-z0-9_]+`は英数字が１文字以上、`.+`は任意の文字が一文字以上、を示す。
  - バックスラッシュは、エスケープを示す。
```
<option value="[a-z0-9_]+">.+<\/option>
```
### valueと表示テキストをキャプチャする。
- 抜き出したいテキストを（）で囲むと、キャプチャすることができる。
- 正規表現でキャプチャをすると、その部分がキャプチャ（補足）され、連番が付けられる。
![Image from Gyazo](https://i.gyazo.com/297ea4f7ff89e4cf911b11bc00956779.png)

### キャプチャを利用して新しい文字列を組み立てる
- テキストエディタなどを使って、置換の作業を行う。
- 置換の際には、　`$1,　$2`と記述すると、キャプチャした内容を「１番目の数字、2番目の数字」と扱って処理することができる。

### 表示がないoptionを置換する。
- 「任意の文字を０文字以上」と示すメタ文字は、`*`。つまり、「任意の文字が一文字以上」は`.*`となる。

`<option value="([a-z0-9_]+)">(.*)<\/option>`

## selectedになっているoptionも置換できるようにする
```html
<select name="game_console">
<option value="none"></option>
<option value="wii_u" selected>Wii U</option>
<option value="ps4">プレステ4</option>
<option value="gb">ゲームボーイ</option>
</select> 
```
- 上記において、selected属性がついているものは、先ほどの正規表現では検索できない。この場合、OR検索を取り入れることで検索できる。
- `A?`と言ったメタ文字は「Aがある、または無い」となるが、これは複数文字に対しても使用できる。複数文字を使う場合は対象を（）で囲む必要がある。（これをグループ化という）
- 普通に（）？と書くだけだと、キャプチャの対象となってしまうので、キャプチャの必要がなければ、カッコの中に`?:`を付ける。
```
<option value="([a-z0-9_]+)"(?: selected)?>(.*)<\/option>
```
### 正規表現をシンプルにする。
- `0-9`は`\d`と表すことができるが、これは[]の中でも使える。
```
<option value="([a-z\d_]+)"(?: selected)?>(.*)<\/option>
```
- a-zは英単語を表す`\w`というメタ文字に置き換えることができる。厳密には、`\w`は大文字を含む英単語を検索する。
```
<option value="([\w\d_]+)"(?: selected)?>(.*)<\/option>
```
## * と + は「貪欲」であることに注意！
- `*, +`は「貪欲なマッチを試みる量指定子」と呼ばれ、パターンに合致する文字列があれば、最後まで検索対象とする。

### 解決策①「任意の一文字以上」をより厳しい条件にする
- 「任意の一文字」ではなく、「『検索をとめたい箇所にある文字』以外の文字」を指定するとうまく行く。
- 具体的には、「A以外の文字」は`[^A]`と書く。＾を入れることで、否定を指示できる。
```
<option value="(\w+)"(?: selected)?>([^<]*)<\/option>
```
### 解決策②最短のマッチを返すように指定する。
- 「`>`で始まり、任意の文字が0個以上連続し（`.*`）、最初に見つかった `<`で終わる」を実現するには、`*, +`に？を付けて`*?, +?`とする。これを***最小量指定子***と呼ぶ。貪欲なマッチと対比し、控えめなマッチとも呼ばれる。
- `>(.*?)<`と書くと、最初にマッチした`<`で検索が終わるようになる。
```
<option value="(\w+)"(?: selected)?>(.*?)<\/option>
```

## ミスが許されない置換は1個ずつ確認することが大事
- 正規表現を使った置換は大変便利だが、想定外の文字列が意図しない形に変換されることがある。ミスが許されないケースでは、１個ずつ置換を確認しながら進めること。

# 3
# 4

# 参考
[初心者歓迎！手と目で覚える正規表現入門・その１「さまざまな形式の電話番号を検索しよう」](https://qiita.com/jnchito/items/893c887fbf19e17d3ff9)

[初心者歓迎！手と目で覚える正規表現入門・その２「微妙な違いを許容しつつ置換しよう」](https://qiita.com/jnchito/items/64c3fdc53766ac6f2008)

[Rubular](https://rubular.com/)

