# データベース基礎
- データモデリングは、システムの開発や拡張スピード、システムのパフォーマンスに大きく影響するため、とても重要。

## 課題
伝票をもとにテーブルを作成する。
[![Image from Gyazo](https://i.gyazo.com/3613365284c97db44010e6f7e137508c.jpg)](https://gyazo.com/3613365284c97db44010e6f7e137508c)

### まず最初に要素を書き出してみる
- テーブルNo.
- 人数
- 担当No.
- 伝票No.
- 店名（FC名と店舗名）
- おそらく、入店日時
- オーダーの各メニュー
- オーダーの各個数
- オーダーの金額
- オーダーの合計金額
- アルコールの有無

#### 要素を使って概念のパズルを作ってみる。
- AのB（所有）
- AのB（属性）
- AがBする（主述）
- BをAする（動詞と目的語）
- AがあるからBがある

大きな要素（エンティティ）から順に整理していくと良いらしい。また、実際に使用される場面をイメージしながら作ること。

[![Image from Gyazo](https://i.gyazo.com/77460a6c8a280ea0886956650147fb83.png)](https://gyazo.com/77460a6c8a280ea0886956650147fb83)

### ER図（実体関連図）に書き出す
以下のように、概念のパズルから展開していく

[![Image from Gyazo](https://i.gyazo.com/7e3cf472d3247786b9bb7f4ea90ccedb.png)](https://gyazo.com/7e3cf472d3247786b9bb7f4ea90ccedb)

[![Image from Gyazo](https://i.gyazo.com/5e06941dc99907dc0d6008cc7baecabb.png)](https://gyazo.com/5e06941dc99907dc0d6008cc7baecabb)

この手書きの図を具体的なER図に変換してみる
[![Image from Gyazo](https://i.gyazo.com/9fd106d286b41f160781471456721543.png)](https://gyazo.com/9fd106d286b41f160781471456721543)

従属していない概念は、親の属性に含めても問題ない。概念と属性の垣根は曖昧であるため、その時々の状況による。
その概念が重要であれば概念として独立させ、そうでなければ属性として親に含めて良い(状況による)

### 正規化する
正規化では、エンティティをリソース系とイベント系に分類する。分類のポイントとしては、日時情報を含むかどうか。日時情報を含むリソースはイベント系に分類できる。

リソース系はShop、Staff、Menu、イベント系はOrderに分類できる。

また、リソース系に該当するエンティティは、親にマスターのリソース系エンティティを設定することで、データの冗長化を防ぐことができる。冗長化につながるフィールド（カラム）はマスターに移す。

[![Image from Gyazo](https://i.gyazo.com/acef459a215b51ecd6361d0e7325a460.png)](https://gyazo.com/acef459a215b51ecd6361d0e7325a460)

### その他気をつける事
- カラム名は、シモニムとホモニムには気をつける。
  - シモニムとは呼び名は違っているが同じ内容を指すもので、ホモニムは呼び名は同じだが違う意味を指すもの。いずれもエンジニアの開発効率に悪影響を及ぼしてしまう。
  - 同じ情報を持つカラムは同じカラム名にし、違う情報を持つカラムは違うカラム名にする。
- 正規化で意識することは「壊れないデータとは何か」
  - 正規化は壊れないデータを作ることを目的にするもので、正規化自体が目的ではない。
  - データの更新操作がデータの整合性に影響する状況が考えられる場合、正規化して切り出すと良い。

[![Image from Gyazo](https://i.gyazo.com/81238be014d8842e282150721687dd9d.png)](https://gyazo.com/81238be014d8842e282150721687dd9d)

[![Image from Gyazo](https://i.gyazo.com/7fad5c4a8ad46cba31587110570d5759.png)](https://gyazo.com/7fad5c4a8ad46cba31587110570d5759)
- 正規化してはいけないケースとして、「ある時点でのデータを保持するもの」（購入時の価格情報など）
  - 正規化して切り出すと、マスターテーブルの情報の更新が過去の情報にまで反映されてしまうため、この場合は正規化するべきではない。
### 参考
[【DB設計入門|ER図|MySQL】コンビニレシートから学ぶ！データモデリング手法](https://engineers.weddingpark.co.jp/mysql-database-design/)

[データベーステーブル設計の基礎の基礎～エンティティの抽出・定義から正規化まで](https://eh-career.com/engineerhub/entry/2018/06/22/110000)

[やさしい図解で学ぶ　ER図　表記法一覧 - Qiita](https://qiita.com/ramuneru/items/32fbf3032b625f71b69d)
